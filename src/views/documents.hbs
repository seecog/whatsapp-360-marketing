{{!-- views/documents.hbs --}}
<div class="container-fluid">
  <div class="row">
    {{!-- Sidebar same as Employees page, but Documents active --}}
    <div class="col-md-3 col-lg-2 px-0">
      <div class="sidebar p-3">
        <div class="text-center mb-2">
          <h5 class="text-white">WhatsApp Manager</h5>
          <small class="text-white-50">{{user.firstName}} {{user.lastName}}</small>
        </div>
        <nav class="nav flex-column">
          <div class="menu-toggle" onclick="toggleMenu('whatsapp-submenu')">
            <div class="nav-link">
              <i class="fab fa-whatsapp"></i> WhatsApp
              <i class="fas fa-chevron-down float-end"></i>
            </div>
          </div>
          <div class="submenu show" id="whatsapp-submenu">
            <a class="nav-link" href="/dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a class="nav-link" href="/business"><i class="fas fa-building"></i> Business</a>
            <a class="nav-link" href="/customers"><i class="fas fa-users"></i> Customers</a>
            <a class="nav-link" href="/templates"><i class="fas fa-file-alt"></i> Templates</a>
            <a class="nav-link" href="/campaigns"><i class="fas fa-bullhorn"></i> Campaigns</a>
          </div>

          <div class="menu-toggle mt-2" onclick="toggleMenu('hr-submenu')">
            <div class="nav-link active">
              <i class="fas fa-users-cog"></i> HR Tools
              <i class="fas fa-chevron-down float-end"></i>
            </div>
          </div>
          <div class="submenu show" id="hr-submenu">
            <a class="nav-link" href="/employees"><i class="fas fa-user-tie"></i> Employees</a>
            <a class="nav-link active" href="/documents"><i class="fas fa-file-signature"></i> Documents</a>
          </div>

          <div class="menu-toggle mt-2" onclick="toggleMenu('utilities-submenu')">
            <div class="nav-link">
              <i class="fas fa-tools"></i> Utilities
              <i class="fas fa-chevron-down float-end"></i>
            </div>
          </div>
          <div class="submenu" id="utilities-submenu">
            <a class="nav-link" href="/document-types"><i class="fas fa-layer-group"></i> Document Types</a>
          </div>

          <hr class="text-white-50" />
          <a class="nav-link" href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </nav>
      </div>
    </div>

    <div class="col-md-9 col-lg-10">
      <div class="main-content p-4">
        <h2 class="mb-4">Generate Documents</h2>

        <div class="card">
          <div class="card-body">
            <form id="generateDocumentForm" method="POST" action="/documents/generate">
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">Employee</label>
                  <select name="employeeId" class="form-select" required>
                    <option value="">Select employee</option>
                    {{#each employees}}
                      <option value="{{id}}">{{empName}} ({{empId}})</option>
                    {{/each}}
                  </select>
                </div>

                <div class="col-md-6">
                  <label class="form-label">Document Type</label>
                  {{!-- Added id + data-code so JS can detect type --}}
                  <select
                    name="documentTypeId"
                    id="documentTypeSelect"
                    class="form-select"
                    required
                  >
                    <option value="">Select document type</option>
                    {{#each documentTypes}}
                      <option
                        value="{{id}}"
                        data-code="{{code}}"
                      >
                        {{name}} ({{code}})
                      </option>
                    {{/each}}
                  </select>
                </div>
              </div>

              {{!-- Extra dynamic fields section --}}
              <div class="row g-3 mt-3">
                {{!-- Bonus Letter extra field --}}
                <div class="col-md-6" id="bonusFieldWrapper" style="display: none;">
                  <label class="form-label" for="bonusAmount">
                    Bonus Amount (₹)
                  </label>
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    class="form-control"
                    id="bonusAmount"
                    name="bonusAmount"
                    placeholder="Enter bonus amount"
                  />
                </div>

                {{!-- Increment Letter extra field --}}
                <div class="col-md-6" id="incrementFieldWrapper" style="display: none;">
                  <label class="form-label" for="incrementAmount">
                    Salary Increment (₹)
                  </label>
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    class="form-control"
                    id="incrementAmount"
                    name="incrementAmount"
                    placeholder="Enter increment amount"
                  />
                </div>
              </div>

              <div class="mt-4 d-flex justify-content-end">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-file-pdf me-2"></i>Generate Document (PDF)
                </button>
              </div>
            </form>

            <p class="text-muted mt-3">
              The PDF will be generated in A4 size and downloaded automatically.
            </p>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
  (function () {
    const docTypeSelect = document.getElementById('documentTypeSelect');
    const bonusFieldWrapper = document.getElementById('bonusFieldWrapper');
    const incrementFieldWrapper = document.getElementById('incrementFieldWrapper');
    const bonusAmountInput = document.getElementById('bonusAmount');
    const incrementAmountInput = document.getElementById('incrementAmount');

    function resetDynamicFields() {
      bonusFieldWrapper.style.display = 'none';
      incrementFieldWrapper.style.display = 'none';

      if (bonusAmountInput) bonusAmountInput.value = '';
      if (incrementAmountInput) incrementAmountInput.value = '';
    }

    function handleDocTypeChange() {
      resetDynamicFields();

      const selectedOption = docTypeSelect.options[docTypeSelect.selectedIndex];
      if (!selectedOption) return;

      const rawCode = selectedOption.getAttribute('data-code') || '';
      const code = rawCode.toUpperCase();

      // Show Bonus field for BONUS_LETTER / BONUS
      if (code === 'BONUS_LETTER' || code === 'BONUS') {
        bonusFieldWrapper.style.display = 'block';
      }

      // Show Increment field for INCREMENT_LETTER / INCREMENT
      if (code === 'INCREMENT_LETTER' || code === 'INCREMENT') {
        incrementFieldWrapper.style.display = 'block';
      }
    }

    if (docTypeSelect) {
      docTypeSelect.addEventListener('change', handleDocTypeChange);
      // run once on page load if some option is pre-selected
      handleDocTypeChange();
    }
  })();
</script>
