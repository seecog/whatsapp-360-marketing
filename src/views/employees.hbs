{{!-- views/employees.hbs --}}
<div class="container-fluid">
  <div class="row">
    {{!-- Sidebar --}}
    <div class="col-md-3 col-lg-2 px-0">
      <div class="sidebar p-3">
        <div class="text-center mb-2">
          <h5 class="text-white">WhatsApp Manager</h5>
          <small class="text-white-50">{{user.firstName}} {{user.lastName}}</small>
        </div>
        <nav class="nav flex-column">
          <div class="menu-toggle" onclick="toggleMenu('whatsapp-submenu')">
            <div class="nav-link">
              <i class="fab fa-whatsapp"></i> WhatsApp
              <i class="fas fa-chevron-down float-end"></i>
            </div>
          </div>
          <div class="submenu show" id="whatsapp-submenu">
            <a class="nav-link" href="/dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a class="nav-link" href="/business"><i class="fas fa-building"></i> Business</a>
            <a class="nav-link" href="/customers"><i class="fas fa-users"></i> Customers</a>
            <a class="nav-link" href="/templates"><i class="fas fa-file-alt"></i> Templates</a>
            <a class="nav-link" href="/campaigns"><i class="fas fa-bullhorn"></i> Campaigns</a>
          </div>

          <div class="menu-toggle mt-2" onclick="toggleMenu('hr-submenu')">
            <div class="nav-link active">
              <i class="fas fa-users-cog"></i> HR Tools
              <i class="fas fa-chevron-down float-end"></i>
            </div>
          </div>
          <div class="submenu show" id="hr-submenu">
            <a class="nav-link active" href="/employees"><i class="fas fa-user-tie"></i> Employees</a>
            <a class="nav-link" href="/documents"><i class="fas fa-file-signature"></i> Documents</a>
          </div>

          <div class="menu-toggle mt-2" onclick="toggleMenu('utilities-submenu')">
            <div class="nav-link">
              <i class="fas fa-tools"></i> Utilities
              <i class="fas fa-chevron-down float-end"></i>
            </div>
          </div>
          <div class="submenu" id="utilities-submenu">
            <a class="nav-link" href="/document-types"><i class="fas fa-layer-group"></i> Document Types</a>
          </div>

          <hr class="text-white-50" />
          <a class="nav-link" href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </nav>
      </div>
    </div>

    {{!-- Main content --}}
    <div class="col-md-9 col-lg-10">
      <div class="main-content p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h2 class="mb-0">Employees</h2>

            {{!-- info about filter / count --}}
            {{#if search}}
              <small class="text-muted">
                Showing results for: "<strong>{{search}}</strong>"
              </small>
            {{else}}
              <small class="text-muted">
                Total employees:
                {{#if employees.length}}{{employees.length}}{{else}}0{{/if}}
              </small>
            {{/if}}
          </div>

          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEmployeeModal">
            <i class="fas fa-plus me-2"></i>Add Employee
          </button>
        </div>

        {{!-- Search form --}}
        <form class="row mb-3" id="employeeSearchForm" method="GET" action="/employees">
          <div class="col-md-4 mb-2">
            <input
              type="text"
              id="employeeSearchInput"
              name="search"
              class="form-control"
              placeholder="Search by name, email, ID"
              value="{{search}}"
            />
          </div>
          <div class="col-md-2 mb-2">
            <button class="btn btn-outline-secondary w-100" type="submit">
              <i class="fas fa-search me-1"></i>Search
            </button>
          </div>
          {{#if search}}
            <div class="col-md-2 mb-2">
              <a class="btn btn-outline-light w-100" href="/employees">
                <i class="fas fa-times me-1"></i>Clear
              </a>
            </div>
          {{/if}}
        </form>

        {{!-- Employees table --}}
        <div class="card">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-striped mb-0">
                <thead class="table-light">
                  <tr>
                    <th>#</th>
                    <th>Emp ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Designation</th>
                    <th>Department</th>
                    <th>DOJ</th>
                  </tr>
                </thead>
                <tbody>
                  {{#if employees.length}}
                    {{#each employees}}
                      <tr>
                        <td>{{inc @index}}</td>
                        <td>{{empId}}</td>
                        <td>{{empName}}</td>
                        <td>{{empEmail}}</td>
                        <td>{{empPhone}}</td>
                        <td>{{empDesignation}}</td>
                        <td>{{empDepartment}}</td>
                        <td>{{empDateOfJoining}}</td>
                      </tr>
                    {{/each}}
                  {{else}}
                    <tr>
                      <td colspan="8" class="text-center py-3">
                        No employees found.
                      </td>
                    </tr>
                  {{/if}}
                </tbody>
              </table>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

{{!-- Add Employee Modal --}}
<div class="modal fade" id="addEmployeeModal" tabindex="-1">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <form id="addEmployeeForm">
        <div class="modal-header">
          <h5 class="modal-title">Add Employee</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          {{!-- Tabs header (6 sections) --}}
          <ul class="nav nav-tabs" id="addEmployeeTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="basic-tab"
                data-bs-toggle="tab"
                data-bs-target="#tab-basic"
                type="button"
                role="tab"
              >
                1) Personal Details
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="job-tab"
                data-bs-toggle="tab"
                data-bs-target="#tab-job"
                type="button"
                role="tab"
              >
                2) Professional Details
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="comp-tab"
                data-bs-toggle="tab"
                data-bs-target="#tab-comp"
                type="button"
                role="tab"
              >
                3) Compensation
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="edu-tab"
                data-bs-toggle="tab"
                data-bs-target="#tab-education"
                type="button"
                role="tab"
              >
                4) Education &amp; Qualification
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="exp-tab"
                data-bs-toggle="tab"
                data-bs-target="#tab-experience"
                type="button"
                role="tab"
              >
                5) Experience / Employment History
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="docs-tab"
                data-bs-toggle="tab"
                data-bs-target="#tab-documents"
                type="button"
                role="tab"
              >
                6) Documents &amp; KYC
              </button>
            </li>
          </ul>

          {{!-- Tabs content --}}
          <div class="tab-content pt-3" id="addEmployeeTabContent">

            {{!-- TAB 1: PERSONAL DETAILS --}}
            <div
              class="tab-pane fade show active"
              id="tab-basic"
              role="tabpanel"
            >
              <div class="row g-3">
                <div class="col-md-4">
                  <label class="form-label">First Name</label>
                  <input type="text" name="firstName" class="form-control" required />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Middle Name</label>
                  <input type="text" name="middleName" class="form-control" />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Last Name</label>
                  <input type="text" name="lastName" class="form-control" required />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Gender</label>
                  <select name="gender" class="form-select">
                    <option value="">Select</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Non-binary">Non-binary</option>
                    <option value="Prefer not to say">Prefer not to say</option>
                  </select>
                </div>

                <div class="col-md-4">
                  <label class="form-label">Marital Status</label>
                  <select name="maritalStatus" class="form-select">
                    <option value="">Select</option>
                    <option value="Single">Single</option>
                    <option value="Married">Married</option>
                    <option value="Other">Other</option>
                  </select>
                </div>

                <div class="col-md-4">
                  <label class="form-label">Date of Birth</label>
                  <input type="date" name="empDob" class="form-control" required />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Blood Group</label>
                  <input type="text" name="bloodGroup" class="form-control" />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Nationality</label>
                  <input type="text" name="nationality" class="form-control" />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Religion</label>
                  <input type="text" name="religion" class="form-control" />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Category / Caste</label>
                  <input type="text" name="casteCategory" class="form-control" />
                </div>

                <div class="col-md-8">
                  <label class="form-label">Languages Known</label>
                  <input
                    type="text"
                    name="languagesKnown"
                    class="form-control"
                    placeholder="e.g. English, Hindi, Bengali"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Primary Contact Number</label>
                  <input
                    type="text"
                    name="empPhone"
                    maxlength="10"
                    class="form-control"
                    required
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Alternate Contact Number</label>
                  <input
                    type="text"
                    name="altPhone"
                    maxlength="10"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Personal Email</label>
                  <input
                    type="email"
                    name="empEmail"
                    class="form-control"
                    required
                  />
                </div>

                <div class="col-12">
                  <hr />
                  <h6>Emergency Contact</h6>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Name</label>
                  <input
                    type="text"
                    name="emergencyContactName"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Relation</label>
                  <input
                    type="text"
                    name="emergencyContactRelation"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Contact Number</label>
                  <input
                    type="text"
                    name="emergencyContactNumber"
                    maxlength="10"
                    class="form-control"
                  />
                </div>

                <div class="col-12">
                  <hr />
                  <h6>Present Address</h6>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Address Line 1</label>
                  <input
                    type="text"
                    name="presentAddressLine1"
                    class="form-control"
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Address Line 2</label>
                  <input
                    type="text"
                    name="presentAddressLine2"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">City</label>
                  <input type="text" name="presentCity" class="form-control" />
                </div>
                <div class="col-md-4">
                  <label class="form-label">State</label>
                  <input type="text" name="presentState" class="form-control" />
                </div>
                <div class="col-md-2">
                  <label class="form-label">ZIP</label>
                  <input type="text" name="presentZip" class="form-control" />
                </div>
                <div class="col-md-2">
                  <label class="form-label">Country</label>
                  <input type="text" name="presentCountry" class="form-control" />
                </div>

                <div class="col-12">
                  <div class="form-check mt-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="sameAsPresent"
                      name="permanentSameAsPresent"
                    />
                    <label class="form-check-label" for="sameAsPresent">
                      Permanent address same as present
                    </label>
                  </div>
                </div>

                <div class="col-12">
                  <hr />
                  <h6>Permanent Address</h6>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Address Line 1</label>
                  <input
                    type="text"
                    name="permanentAddressLine1"
                    class="form-control"
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Address Line 2</label>
                  <input
                    type="text"
                    name="permanentAddressLine2"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">City</label>
                  <input type="text" name="permanentCity" class="form-control" />
                </div>
                <div class="col-md-4">
                  <label class="form-label">State</label>
                  <input type="text" name="permanentState" class="form-control" />
                </div>
                <div class="col-md-2">
                  <label class="form-label">ZIP</label>
                  <input type="text" name="permanentZip" class="form-control" />
                </div>
                <div class="col-md-2">
                  <label class="form-label">Country</label>
                  <input type="text" name="permanentCountry" class="form-control" />
                </div>
              </div>
            </div>

            {{!-- TAB 2: PROFESSIONAL DETAILS --}}
            <div
              class="tab-pane fade"
              id="tab-job"
              role="tabpanel"
            >
              <div class="row g-3">
                <div class="col-md-4">
                  <label class="form-label">Employee Code / ID (optional)</label>
                  <input type="text" name="empId" class="form-control" />
                  <small class="text-muted">
                    Leave blank to autogenerate (EMP0001…)
                  </small>
                </div>

                <div class="col-md-4">
                  <label class="form-label">Employee Type</label>
                  <select name="employeeType" class="form-select" required>
                    <option value="Permanent">Permanent</option>
                    <option value="Contract">Contract</option>
                    <option value="Intern">Intern</option>
                    <option value="Consultant">Consultant</option>
                    <option value="Trainee">Trainee</option>
                  </select>
                </div>

                <div class="col-md-4">
                  <label class="form-label">Employment Status</label>
                  <select name="employmentStatus" class="form-select">
                    <option value="Active">Active</option>
                    <option value="On Leave">On Leave</option>
                    <option value="Resigned">Resigned</option>
                    <option value="Terminated">Terminated</option>
                    <option value="Retired">Retired</option>
                  </select>
                </div>

                <div class="col-md-6">
                  <label class="form-label">Department</label>
                  <input
                    type="text"
                    name="empDepartment"
                    class="form-control"
                    required
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Designation / Job Title</label>
                  <input
                    type="text"
                    name="empDesignation"
                    class="form-control"
                    required
                  />
                </div>

                <div class="col-md-6">
                  <label class="form-label">Division / Business Unit</label>
                  <input
                    type="text"
                    name="division"
                    class="form-control"
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Sub-Department / Team</label>
                  <input
                    type="text"
                    name="subDepartment"
                    class="form-control"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Grade / Band / Level</label>
                  <input
                    type="text"
                    name="gradeBandLevel"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Reporting Manager (Employee ID / Ref)</label>
                  <input
                    type="text"
                    name="reportingManagerId"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Work Mode</label>
                  <select name="workMode" class="form-select">
                    <option value="On-site">On-site</option>
                    <option value="Hybrid">Hybrid</option>
                    <option value="Remote">Remote</option>
                  </select>
                </div>

                <div class="col-md-4">
                  <label class="form-label">Work Location / Branch</label>
                  <input
                    type="text"
                    name="empWorkLoc"
                    class="form-control"
                    required
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Joining Date</label>
                  <input
                    type="date"
                    name="empDateOfJoining"
                    class="form-control"
                    required
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Probation Period (months)</label>
                  <input
                    type="number"
                    name="probationPeriodMonths"
                    class="form-control"
                    min="0"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Confirmation Date</label>
                  <input
                    type="date"
                    name="confirmationDate"
                    class="form-control"
                  />
                </div>
              </div>
            </div>

            {{!-- TAB 3: COMPENSATION --}}
            <div
              class="tab-pane fade"
              id="tab-comp"
              role="tabpanel"
            >
              <div class="row g-3">
                <div class="col-md-4">
                  <label class="form-label">CTC (₹ - Annual)</label>
                  <input
                    type="number"
                    step="0.01"
                    name="empCtc"
                    class="form-control"
                    required
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Gross Salary (Monthly)</label>
                  <input
                    type="number"
                    step="0.01"
                    name="grossSalaryMonthly"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Basic Salary</label>
                  <input
                    type="number"
                    step="0.01"
                    name="basicSalary"
                    class="form-control"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">House Rent Allowance (HRA)</label>
                  <input
                    type="number"
                    step="0.01"
                    name="hra"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Conveyance Allowance</label>
                  <input
                    type="number"
                    step="0.01"
                    name="conveyanceAllowance"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Medical Allowance</label>
                  <input
                    type="number"
                    step="0.01"
                    name="medicalAllowance"
                    class="form-control"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Special Allowance / Other</label>
                  <input
                    type="number"
                    step="0.01"
                    name="specialAllowance"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Performance Bonus</label>
                  <input
                    type="number"
                    step="0.01"
                    name="performanceBonus"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Variable Pay</label>
                  <input
                    type="number"
                    step="0.01"
                    name="variablePay"
                    class="form-control"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Overtime Eligibility</label>
                  <select name="overtimeEligible" class="form-select">
                    <option value="false">No</option>
                    <option value="true">Yes</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Shift Allowance / Night Allowance</label>
                  <input
                    type="number"
                    step="0.01"
                    name="shiftAllowance"
                    class="form-control"
                  />
                </div>

                <div class="col-12">
                  <hr />
                  <h6>Deductions</h6>
                </div>

                <div class="col-md-3">
                  <label class="form-label">PF</label>
                  <input
                    type="number"
                    step="0.01"
                    name="pfDeduction"
                    class="form-control"
                  />
                </div>
                <div class="col-md-3">
                  <label class="form-label">ESI</label>
                  <input
                    type="number"
                    step="0.01"
                    name="esiDeduction"
                    class="form-control"
                  />
                </div>
                <div class="col-md-3">
                  <label class="form-label">Professional Tax</label>
                  <input
                    type="number"
                    step="0.01"
                    name="professionalTax"
                    class="form-control"
                  />
                </div>
                <div class="col-md-3">
                  <label class="form-label">TDS</label>
                  <input
                    type="number"
                    step="0.01"
                    name="tdsDeduction"
                    class="form-control"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Net Salary (In-hand)</label>
                  <input
                    type="number"
                    step="0.01"
                    name="netSalary"
                    class="form-control"
                  />
                </div>
              </div>
            </div>

            {{!-- TAB 4: EDUCATION & QUALIFICATION --}}
            <div
              class="tab-pane fade"
              id="tab-education"
              role="tabpanel"
            >
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="mb-0">Education Entries</h6>
                <button type="button" class="btn btn-sm btn-outline-primary" id="addEducationRowBtn">
                  <i class="fas fa-plus me-1"></i>Add Education
                </button>
              </div>
              <div id="educationRows" class="row g-3">
                {{!-- one template row --}}
                <div class="education-row border rounded p-3 mb-2">
                  <div class="row g-3">
                    <div class="col-md-3">
                      <label class="form-label">Highest Qualification</label>
                      <select class="form-select edu_level">
                        <option value="">Select</option>
                        <option value="10th">10th</option>
                        <option value="12th">12th</option>
                        <option value="Diploma">Diploma</option>
                        <option value="Bachelors">Bachelors</option>
                        <option value="Masters">Masters</option>
                        <option value="Doctorate">Doctorate</option>
                        <option value="Other">Other</option>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Degree / Course Name</label>
                      <input type="text" class="form-control edu_degree" placeholder="e.g. B.Tech in CSE" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Specialization / Major</label>
                      <input type="text" class="form-control edu_specialization" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Institution Name</label>
                      <input type="text" class="form-control edu_institutionName" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Board (for school)</label>
                      <input type="text" class="form-control edu_board" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Start Year</label>
                      <input type="number" class="form-control edu_startYear" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">End Year</label>
                      <input type="number" class="form-control edu_endYear" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Year of Passing</label>
                      <input type="number" class="form-control edu_yearOfPassing" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Percentage / CGPA</label>
                      <input type="text" class="form-control edu_percentageOrCgpa" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Mode of Study</label>
                      <select class="form-select edu_modeOfStudy">
                        <option value="">Select</option>
                        <option value="Full-Time">Full-Time</option>
                        <option value="Part-Time">Part-Time</option>
                        <option value="Distance">Distance</option>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Education Type</label>
                      <select class="form-select edu_educationType">
                        <option value="">Select</option>
                        <option value="School">School</option>
                        <option value="College">College</option>
                        <option value="Professional">Professional</option>
                        <option value="Technical">Technical</option>
                        <option value="Other">Other</option>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Country</label>
                      <input type="text" class="form-control edu_country" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">City</label>
                      <input type="text" class="form-control edu_city" />
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Certificate / Marksheet URL</label>
                      <input type="text" class="form-control edu_certificateUrl" placeholder="https://..." />
                    </div>
                    <div class="col-md-2 d-flex align-items-end justify-content-end">
                      <button type="button" class="btn btn-outline-danger btn-sm remove-education-row-btn">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {{!-- TAB 5: EXPERIENCE --}}
            <div
              class="tab-pane fade"
              id="tab-experience"
              role="tabpanel"
            >
              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="mb-0">Employment History</h6>
                <button type="button" class="btn btn-sm btn-outline-primary" id="addExperienceRowBtn">
                  <i class="fas fa-plus me-1"></i>Add Experience
                </button>
              </div>
              <div id="experienceRows" class="row g-3">
                <div class="experience-row border rounded p-3 mb-2">
                  <div class="row g-3">
                    <div class="col-md-4">
                      <label class="form-label">Organization / Company Name</label>
                      <input type="text" class="form-control exp_organizationName" />
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Designation / Job Title</label>
                      <input type="text" class="form-control exp_jobTitle" />
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Employment Type</label>
                      <select class="form-select exp_employmentType">
                        <option value="">Select</option>
                        <option value="Full-Time">Full-Time</option>
                        <option value="Part-Time">Part-Time</option>
                        <option value="Contract">Contract</option>
                        <option value="Internship">Internship</option>
                        <option value="Freelance">Freelance</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Department / Division</label>
                      <input type="text" class="form-control exp_department" />
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Industry Type</label>
                      <input type="text" class="form-control exp_industryType" />
                    </div>
                    <div class="col-md-2">
                      <label class="form-label">City</label>
                      <input type="text" class="form-control exp_companyLocationCity" />
                    </div>
                    <div class="col-md-2">
                      <label class="form-label">Country</label>
                      <input type="text" class="form-control exp_companyLocationCountry" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Start Date</label>
                      <input type="date" class="form-control exp_startDate" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">End Date</label>
                      <input type="date" class="form-control exp_endDate" />
                    </div>
                    <div class="col-md-3 d-flex align-items-center">
                      <div class="form-check mt-3">
                        <input
                          type="checkbox"
                          class="form-check-input exp_isCurrent"
                        />
                        <label class="form-check-label">Present (currently working)</label>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Last Drawn Salary / CTC</label>
                      <input type="number" step="0.01" class="form-control exp_lastDrawnCtc" />
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Reason for Leaving</label>
                      <input type="text" class="form-control exp_reasonForLeaving" />
                    </div>
                    <div class="col-md-3 d-flex align-items-center">
                      <div class="form-check mt-3">
                        <input
                          type="checkbox"
                          class="form-check-input exp_noticePeriodServed"
                        />
                        <label class="form-check-label">Notice Period Served</label>
                      </div>
                    </div>
                    <div class="col-md-2 d-flex align-items-end justify-content-end">
                      <button type="button" class="btn btn-outline-danger btn-sm remove-experience-row-btn">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {{!-- TAB 6: DOCUMENTS & KYC --}}
            <div
              class="tab-pane fade"
              id="tab-documents"
              role="tabpanel"
            >
              <div class="row g-3">
                <div class="col-12">
                  <h6>KYC Core (for uniqueness)</h6>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Aadhaar Number</label>
                  <input
                    type="text"
                    name="empAadhar"
                    maxlength="12"
                    class="form-control"
                    required
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">PAN Number</label>
                  <input
                    type="text"
                    name="empPan"
                    maxlength="10"
                    class="form-control"
                    required
                  />
                </div>
              </div>

              <hr class="my-3" />

              <div class="d-flex justify-content-between align-items-center mb-2">
                <h6 class="mb-0">Employee Documents</h6>
                <button type="button" class="btn btn-sm btn-outline-primary" id="addDocumentRowBtn">
                  <i class="fas fa-plus me-1"></i>Add Document
                </button>
              </div>

              <div id="documentRows" class="row g-3">
                <div class="document-row border rounded p-3 mb-2">
                  <div class="row g-3">
                    <div class="col-md-3">
                      <label class="form-label">Category</label>
                      <select class="form-select doc_category">
                        <option value="KYC">KYC</option>
                        <option value="ADDRESS">Address Proof</option>
                        <option value="EDUCATION">Education</option>
                        <option value="EXPERIENCE">Experience</option>
                        <option value="HR">HR Letters</option>
                        <option value="OTHER">Other</option>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Document Type</label>
                      <input
                        type="text"
                        class="form-control doc_documentType"
                        placeholder="Aadhaar, PAN, Passport, 10th Marksheet, Offer Letter..."
                      />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Name as per Document</label>
                      <input type="text" class="form-control doc_nameOnDocument" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Document Number</label>
                      <input type="text" class="form-control doc_documentNumber" />
                    </div>

                    <div class="col-md-3">
                      <label class="form-label">Issue Date</label>
                      <input type="date" class="form-control doc_issueDate" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Expiry Date</label>
                      <input type="date" class="form-control doc_expiryDate" />
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Verification Status</label>
                      <select class="form-select doc_verificationStatus">
                        <option value="Pending">Pending</option>
                        <option value="Verified">Verified</option>
                        <option value="Rejected">Rejected</option>
                      </select>
                    </div>

                    <div class="col-md-6">
                      <label class="form-label">File URL (PDF / Doc)</label>
                      <input
                        type="text"
                        class="form-control doc_fileUrl"
                        placeholder="/uploads/documents/... or https://..."
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Document Image URL</label>
                      <input
                        type="text"
                        class="form-control doc_documentImageUrl"
                        placeholder="Scanned image URL/path"
                      />
                    </div>

                    <div class="col-md-10">
                      <label class="form-label">Notes</label>
                      <textarea class="form-control doc_notes" rows="2"></textarea>
                    </div>
                    <div class="col-md-2 d-flex align-items-end justify-content-end">
                      <button type="button" class="btn btn-outline-danger btn-sm remove-document-row-btn">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </div>
                </div>
              </div>

            </div> {{!-- end tab-documents --}}
          </div> {{!-- end tab-content --}}
        </div> {{!-- end modal-body --}}

        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">
            Cancel
          </button>

          {{!-- Wizard buttons --}}
          <button
            class="btn btn-primary"
            type="button"
            id="wizardNextBtn"
          >
            Next
          </button>
          <button
            class="btn btn-primary d-none"
            type="submit"
            id="wizardSaveBtn"
          >
            Save Employee
          </button>
        </div>
      </form>
    </div>
  </div>
</div>


<script>
  (function () {
    // --- Wizard steps (6 tabs) ---
    const steps = [
      'tab-basic',
      'tab-job',
      'tab-comp',
      'tab-education',
      'tab-experience',
      'tab-documents',
    ];
    let currentStep = 0;

    const nextBtn = document.getElementById('wizardNextBtn');
    const saveBtn = document.getElementById('wizardSaveBtn');
    const tabsContainer = document.getElementById('addEmployeeTabs');
    const modalEl = document.getElementById('addEmployeeModal');

    function updateWizardButtons() {
      if (currentStep === steps.length - 1) {
        nextBtn.classList.add('d-none');
        saveBtn.classList.remove('d-none');
      } else {
        nextBtn.classList.remove('d-none');
        saveBtn.classList.add('d-none');
      }
    }

    function goToStep(index) {
      if (index < 0 || index >= steps.length) return;
      const targetId = steps[index];
      const trigger = document.querySelector('[data-bs-target="#' + targetId + '"]');
      if (trigger && window.bootstrap) {
        const tab = new bootstrap.Tab(trigger);
        tab.show();
      }
    }

    nextBtn.addEventListener('click', function () {
      if (currentStep < steps.length - 1) {
        currentStep += 1;
        goToStep(currentStep);
        updateWizardButtons();
      }
    });

    if (tabsContainer) {
      tabsContainer.addEventListener('shown.bs.tab', function (event) {
        const target = event.target.getAttribute('data-bs-target'); // "#tab-job"
        if (!target) return;
        const id = target.replace('#', '');
        const idx = steps.indexOf(id);
        if (idx !== -1) {
          currentStep = idx;
          updateWizardButtons();
        }
      });
    }

    if (modalEl) {
      modalEl.addEventListener('shown.bs.modal', function () {
        currentStep = 0;
        goToStep(currentStep);
        updateWizardButtons();
      });
    }

    // --- "Permanent same as present" helper ---
    const sameAsPresentCheckbox = document.getElementById('sameAsPresent');
    if (sameAsPresentCheckbox) {
      sameAsPresentCheckbox.addEventListener('change', function () {
        if (!this.checked) return;
        const copyField = (from, to) => {
          const f = document.querySelector('[name="' + from + '"]');
          const t = document.querySelector('[name="' + to + '"]');
          if (f && t) t.value = f.value;
        };
        copyField('presentAddressLine1', 'permanentAddressLine1');
        copyField('presentAddressLine2', 'permanentAddressLine2');
        copyField('presentCity', 'permanentCity');
        copyField('presentState', 'permanentState');
        copyField('presentZip', 'permanentZip');
        copyField('presentCountry', 'permanentCountry');
      });
    }

    // --- Dynamic rows: Education, Experience, Documents ---
    const educationContainer = document.getElementById('educationRows');
    const experienceContainer = document.getElementById('experienceRows');
    const documentContainer = document.getElementById('documentRows');

    const addEducationRowBtn = document.getElementById('addEducationRowBtn');
    const addExperienceRowBtn = document.getElementById('addExperienceRowBtn');
    const addDocumentRowBtn = document.getElementById('addDocumentRowBtn');

    function cloneRow(container, rowSelector) {
      const firstRow = container.querySelector(rowSelector);
      if (!firstRow) return;
      const clone = firstRow.cloneNode(true);
      // Clear all inputs in clone
      clone.querySelectorAll('input, select, textarea').forEach((el) => {
        if (el.type === 'checkbox') {
          el.checked = false;
        } else {
          el.value = '';
        }
      });
      container.appendChild(clone);
    }

    if (addEducationRowBtn && educationContainer) {
      addEducationRowBtn.addEventListener('click', function () {
        cloneRow(educationContainer, '.education-row');
      });

      educationContainer.addEventListener('click', function (e) {
        if (e.target.closest('.remove-education-row-btn')) {
          const row = e.target.closest('.education-row');
          // Keep at least one row
          if (educationContainer.querySelectorAll('.education-row').length > 1) {
            row.remove();
          }
        }
      });
    }

    if (addExperienceRowBtn && experienceContainer) {
      addExperienceRowBtn.addEventListener('click', function () {
        cloneRow(experienceContainer, '.experience-row');
      });

      experienceContainer.addEventListener('click', function (e) {
        if (e.target.closest('.remove-experience-row-btn')) {
          const row = e.target.closest('.experience-row');
          if (experienceContainer.querySelectorAll('.experience-row').length > 1) {
            row.remove();
          }
        }
      });
    }

    if (addDocumentRowBtn && documentContainer) {
      addDocumentRowBtn.addEventListener('click', function () {
        cloneRow(documentContainer, '.document-row');
      });

      documentContainer.addEventListener('click', function (e) {
        if (e.target.closest('.remove-document-row-btn')) {
          const row = e.target.closest('.document-row');
          if (documentContainer.querySelectorAll('.document-row').length > 1) {
            row.remove();
          }
        }
      });
    }

    function collectEducationRows() {
      const rows = [];
      document.querySelectorAll('.education-row').forEach((row) => {
        const obj = {
          level: row.querySelector('.edu_level')?.value || '',
          degree: row.querySelector('.edu_degree')?.value || '',
          specialization: row.querySelector('.edu_specialization')?.value || '',
          institutionName: row.querySelector('.edu_institutionName')?.value || '',
          board: row.querySelector('.edu_board')?.value || '',
          startYear: row.querySelector('.edu_startYear')?.value || '',
          endYear: row.querySelector('.edu_endYear')?.value || '',
          yearOfPassing: row.querySelector('.edu_yearOfPassing')?.value || '',
          percentageOrCgpa: row.querySelector('.edu_percentageOrCgpa')?.value || '',
          modeOfStudy: row.querySelector('.edu_modeOfStudy')?.value || '',
          educationType: row.querySelector('.edu_educationType')?.value || '',
          country: row.querySelector('.edu_country')?.value || '',
          city: row.querySelector('.edu_city')?.value || '',
          certificateUrl: row.querySelector('.edu_certificateUrl')?.value || '',
        };
        // Push only if some key fields present
        if (obj.level || obj.degree || obj.institutionName) {
          rows.push(obj);
        }
      });
      return rows;
    }

    function collectExperienceRows() {
      const rows = [];
      document.querySelectorAll('.experience-row').forEach((row) => {
        const obj = {
          organizationName: row.querySelector('.exp_organizationName')?.value || '',
          jobTitle: row.querySelector('.exp_jobTitle')?.value || '',
          employmentType: row.querySelector('.exp_employmentType')?.value || '',
          department: row.querySelector('.exp_department')?.value || '',
          industryType: row.querySelector('.exp_industryType')?.value || '',
          companyLocationCity: row.querySelector('.exp_companyLocationCity')?.value || '',
          companyLocationCountry: row.querySelector('.exp_companyLocationCountry')?.value || '',
          startDate: row.querySelector('.exp_startDate')?.value || '',
          endDate: row.querySelector('.exp_endDate')?.value || '',
          isCurrent: row.querySelector('.exp_isCurrent')?.checked || false,
          lastDrawnCtc: row.querySelector('.exp_lastDrawnCtc')?.value || '',
          reasonForLeaving: row.querySelector('.exp_reasonForLeaving')?.value || '',
          noticePeriodServed: row.querySelector('.exp_noticePeriodServed')?.checked || false,
        };
        if (obj.organizationName || obj.jobTitle) {
          rows.push(obj);
        }
      });
      return rows;
    }

    function collectDocumentRows() {
      const rows = [];
      document.querySelectorAll('.document-row').forEach((row) => {
        const obj = {
          category: row.querySelector('.doc_category')?.value || '',
          documentType: row.querySelector('.doc_documentType')?.value || '',
          nameOnDocument: row.querySelector('.doc_nameOnDocument')?.value || '',
          documentNumber: row.querySelector('.doc_documentNumber')?.value || '',
          issueDate: row.querySelector('.doc_issueDate')?.value || '',
          expiryDate: row.querySelector('.doc_expiryDate')?.value || '',
          verificationStatus: row.querySelector('.doc_verificationStatus')?.value || 'Pending',
          fileUrl: row.querySelector('.doc_fileUrl')?.value || '',
          documentImageUrl: row.querySelector('.doc_documentImageUrl')?.value || '',
          notes: row.querySelector('.doc_notes')?.value || '',
        };
        if (obj.documentType || obj.documentNumber || obj.fileUrl || obj.documentImageUrl) {
          rows.push(obj);
        }
      });
      return rows;
    }

    // --- Form submit logic ---
    document.getElementById('addEmployeeForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const form = e.target;

      // Base payload from simple fields
      const formData = new FormData(form);
      const base = Object.fromEntries(formData.entries());

      // Attach nested sections
      base.educations = collectEducationRows();
      base.experiences = collectExperienceRows();
      base.documents = collectDocumentRows();

      try {
        const res = await fetch('/api/v1/employees', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(base),
        });

        if (!res.ok) {
          const err = await res.json().catch(() => ({}));
          throw new Error(err.error || 'Failed to create employee');
        }

        window.location.reload();
      } catch (err) {
        alert(err.message);
      }
    });
  })();
</script>



{{!-- <script>
  (function () {
    const steps = ['tab-basic', 'tab-job', 'tab-comp'];
    let currentStep = 0;

    const nextBtn = document.getElementById('wizardNextBtn');
    const saveBtn = document.getElementById('wizardSaveBtn');
    const tabsContainer = document.getElementById('addEmployeeTabs');
    const modalEl = document.getElementById('addEmployeeModal');

    function updateWizardButtons() {
      if (currentStep === steps.length - 1) {
        // Last step: hide Next, show Save
        nextBtn.classList.add('d-none');
        saveBtn.classList.remove('d-none');
      } else {
        // Not last step: show Next, hide Save
        nextBtn.classList.remove('d-none');
        saveBtn.classList.add('d-none');
      }
    }

    function goToStep(index) {
      if (index < 0 || index >= steps.length) return;
      const targetId = steps[index];
      const trigger = document.querySelector('[data-bs-target="#' + targetId + '"]');
      if (trigger && window.bootstrap) {
        const tab = new bootstrap.Tab(trigger);
        tab.show();
      }
    }

    // Handle Next button click
    nextBtn.addEventListener('click', function () {
      if (currentStep < steps.length - 1) {
        currentStep += 1;
        goToStep(currentStep);
        updateWizardButtons();
      }
    });

    // When tab changes (user clicks tab directly), sync currentStep + buttons
    if (tabsContainer) {
      tabsContainer.addEventListener('shown.bs.tab', function (event) {
        const target = event.target.getAttribute('data-bs-target'); // e.g. "#tab-job"
        if (!target) return;
        const id = target.replace('#', '');
        const idx = steps.indexOf(id);
        if (idx !== -1) {
          currentStep = idx;
          updateWizardButtons();
        }
      });
    }

    // When modal opens, always reset to first step
    if (modalEl) {
      modalEl.addEventListener('shown.bs.modal', function () {
        currentStep = 0;
        goToStep(currentStep);
        updateWizardButtons();
      });
    }

    // Form submit logic (only from final step)
    document.getElementById('addEmployeeForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const form = e.target;
      const data = Object.fromEntries(new FormData(form).entries());

      try {
        const res = await fetch('/api/v1/employees', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });

        if (!res.ok) {
          const err = await res.json().catch(() => ({}));
          throw new Error(err.error || 'Failed to create employee');
        }

        window.location.reload();
      } catch (err) {
        alert(err.message);
      }
    });
  })();
</script> --}}
