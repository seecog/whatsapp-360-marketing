{{!-- views/employees.hbs --}}
<div class="container-fluid">
  <div class="row">
    {{!-- Sidebar --}}
    <div class="col-md-3 col-lg-2 px-0">
      <div class="sidebar p-3">
        <div class="text-center mb-2">
          <h5 class="text-white">WhatsApp Manager</h5>
          <small class="text-white-50">{{user.firstName}} {{user.lastName}}</small>
        </div>
        <nav class="nav flex-column">
          <div class="menu-toggle" onclick="toggleMenu('whatsapp-submenu')">
            <div class="nav-link">
              <i class="fab fa-whatsapp"></i> WhatsApp
              <i class="fas fa-chevron-down float-end"></i>
            </div>
          </div>
          <div class="submenu show" id="whatsapp-submenu">
            <a class="nav-link" href="/dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
            <a class="nav-link" href="/business"><i class="fas fa-building"></i> Business</a>
            <a class="nav-link" href="/customers"><i class="fas fa-users"></i> Customers</a>
            <a class="nav-link" href="/templates"><i class="fas fa-file-alt"></i> Templates</a>
            <a class="nav-link" href="/campaigns"><i class="fas fa-bullhorn"></i> Campaigns</a>
          </div>

          <div class="menu-toggle mt-2" onclick="toggleMenu('hr-submenu')">
            <div class="nav-link active">
              <i class="fas fa-users-cog"></i> HR Tools
              <i class="fas fa-chevron-down float-end"></i>
            </div>
          </div>
          <div class="submenu show" id="hr-submenu">
            <a class="nav-link active" href="/employees"><i class="fas fa-user-tie"></i> Employees</a>
            <a class="nav-link" href="/documents"><i class="fas fa-file-signature"></i> Documents</a>
          </div>

          <div class="menu-toggle mt-2" onclick="toggleMenu('utilities-submenu')">
            <div class="nav-link">
              <i class="fas fa-tools"></i> Utilities
              <i class="fas fa-chevron-down float-end"></i>
            </div>
          </div>
          <div class="submenu" id="utilities-submenu">
            <a class="nav-link" href="/document-types"><i class="fas fa-layer-group"></i> Document Types</a>
          </div>

          <hr class="text-white-50" />
          <a class="nav-link" href="#" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </nav>
      </div>
    </div>

    {{!-- Main content --}}
    <div class="col-md-9 col-lg-10">
      <div class="main-content p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <div>
            <h2 class="mb-0">Employees</h2>

            {{!-- info about filter / count --}}
            {{#if search}}
              <small class="text-muted">
                Showing results for: "<strong>{{search}}</strong>"
              </small>
            {{else}}
              <small class="text-muted">
                Total employees:
                {{#if employees.length}}{{employees.length}}{{else}}0{{/if}}
              </small>
            {{/if}}
          </div>

          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEmployeeModal">
            <i class="fas fa-plus me-2"></i>Add Employee
          </button>
        </div>

        {{!-- Search form --}}
        <form class="row mb-3" id="employeeSearchForm" method="GET" action="/employees">
          <div class="col-md-4 mb-2">
            <input
              type="text"
              id="employeeSearchInput"
              name="search"
              class="form-control"
              placeholder="Search by name, email, ID"
              value="{{search}}"
            />
          </div>
          <div class="col-md-2 mb-2">
            <button class="btn btn-outline-secondary w-100" type="submit">
              <i class="fas fa-search me-1"></i>Search
            </button>
          </div>
          {{#if search}}
            <div class="col-md-2 mb-2">
              <a class="btn btn-outline-light w-100" href="/employees">
                <i class="fas fa-times me-1"></i>Clear
              </a>
            </div>
          {{/if}}
        </form>

        {{!-- Employees table --}}
        <div class="card">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-striped mb-0">
                <thead class="table-light">
                  <tr>
                    <th>#</th>
                    <th>Emp ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Designation</th>
                    <th>Department</th>
                    <th>DOJ</th>
                  </tr>
                </thead>
                <tbody>
                  {{#if employees.length}}
                    {{#each employees}}
                      <tr>
                        <td>{{inc @index}}</td>
                        <td>{{empId}}</td>
                        <td>{{empName}}</td>
                        <td>{{empEmail}}</td>
                        <td>{{empPhone}}</td>
                        <td>{{empDesignation}}</td>
                        <td>{{empDepartment}}</td>
                        <td>{{empDateOfJoining}}</td>
                      </tr>
                    {{/each}}
                  {{else}}
                    <tr>
                      <td colspan="8" class="text-center py-3">
                        No employees found.
                      </td>
                    </tr>
                  {{/if}}
                </tbody>
              </table>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

{{!-- Add Employee Modal --}}
<div class="modal fade" id="addEmployeeModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form id="addEmployeeForm">
        <div class="modal-header">
          <h5 class="modal-title">Add Employee</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>

        <div class="modal-body">
          {{!-- Tabs header --}}
          <ul class="nav nav-tabs" id="addEmployeeTabs" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="basic-tab"
                data-bs-toggle="tab"
                data-bs-target="#tab-basic"
                type="button"
                role="tab"
                aria-controls="tab-basic"
                aria-selected="true"
              >
                Personal Details
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="job-tab"
                data-bs-toggle="tab"
                data-bs-target="#tab-job"
                type="button"
                role="tab"
                aria-controls="tab-job"
                aria-selected="false"
              >
                Professional Details
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="comp-tab"
                data-bs-toggle="tab"
                data-bs-target="#tab-comp"
                type="button"
                role="tab"
                aria-controls="tab-comp"
                aria-selected="false"
              >
                Compensation &amp; KYC
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="att-tab"
                data-bs-toggle="tab"
                data-bs-target="#tab-attendance"
                type="button"
                role="tab"
                aria-controls="tab-attendance"
                aria-selected="false"
              >
                Attendance &amp; Leave
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="compAccess-tab"
                data-bs-toggle="tab"
                data-bs-target="#tab-compliance"
                type="button"
                role="tab"
                aria-controls="tab-compliance"
                aria-selected="false"
              >
                Compliance &amp; Access
              </button>
            </li>
          </ul>

          {{!-- Tabs content --}}
          <div class="tab-content pt-3" id="addEmployeeTabContent">

            {{!-- TAB 1: PERSONAL DETAILS --}}
            <div
              class="tab-pane fade show active"
              id="tab-basic"
              role="tabpanel"
              aria-labelledby="basic-tab"
            >
              <div class="row g-3">
                <div class="col-md-4">
                  <label class="form-label">First Name</label>
                  <input type="text" name="firstName" class="form-control" required />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Middle Name</label>
                  <input type="text" name="middleName" class="form-control" />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Last Name</label>
                  <input type="text" name="lastName" class="form-control" required />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Gender</label>
                  <select name="gender" class="form-select">
                    <option value="">Select</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Non-binary">Non-binary</option>
                    <option value="Prefer not to say">Prefer not to say</option>
                  </select>
                </div>

                <div class="col-md-4">
                  <label class="form-label">Marital Status</label>
                  <select name="maritalStatus" class="form-select">
                    <option value="">Select</option>
                    <option value="Single">Single</option>
                    <option value="Married">Married</option>
                    <option value="Other">Other</option>
                  </select>
                </div>

                <div class="col-md-4">
                  <label class="form-label">Date of Birth</label>
                  <input type="date" name="empDob" class="form-control" required />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Blood Group</label>
                  <input type="text" name="bloodGroup" class="form-control" />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Nationality</label>
                  <input type="text" name="nationality" class="form-control" />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Religion</label>
                  <input type="text" name="religion" class="form-control" />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Category / Caste</label>
                  <input type="text" name="casteCategory" class="form-control" />
                </div>

                <div class="col-md-8">
                  <label class="form-label">Languages Known</label>
                  <input
                    type="text"
                    name="languagesKnown"
                    class="form-control"
                    placeholder="e.g. English, Hindi, Bengali"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Primary Contact Number</label>
                  <input
                    type="text"
                    name="empPhone"
                    maxlength="10"
                    class="form-control"
                    required
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Alternate Contact Number</label>
                  <input
                    type="text"
                    name="altPhone"
                    maxlength="10"
                    class="form-control"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Personal Email</label>
                  <input
                    type="email"
                    name="empEmail"
                    class="form-control"
                    required
                  />
                </div>

                <div class="col-12">
                  <hr />
                  <h6>Emergency Contact</h6>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Name</label>
                  <input
                    type="text"
                    name="emergencyContactName"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Relation</label>
                  <input
                    type="text"
                    name="emergencyContactRelation"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Contact Number</label>
                  <input
                    type="text"
                    name="emergencyContactNumber"
                    maxlength="10"
                    class="form-control"
                  />
                </div>

                <div class="col-12">
                  <hr />
                  <h6>Present Address</h6>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Address Line 1</label>
                  <input
                    type="text"
                    name="presentAddressLine1"
                    class="form-control"
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Address Line 2</label>
                  <input
                    type="text"
                    name="presentAddressLine2"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">City</label>
                  <input type="text" name="presentCity" class="form-control" />
                </div>
                <div class="col-md-4">
                  <label class="form-label">State</label>
                  <input type="text" name="presentState" class="form-control" />
                </div>
                <div class="col-md-2">
                  <label class="form-label">ZIP</label>
                  <input type="text" name="presentZip" class="form-control" />
                </div>
                <div class="col-md-2">
                  <label class="form-label">Country</label>
                  <input type="text" name="presentCountry" class="form-control" />
                </div>

                <div class="col-12">
                  <div class="form-check mt-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="sameAsPresent"
                      name="permanentSameAsPresent"
                    />
                    <label class="form-check-label" for="sameAsPresent">
                      Permanent address same as present
                    </label>
                  </div>
                </div>

                <div class="col-12">
                  <hr />
                  <h6>Permanent Address</h6>
                </div>
                <div class="col-md-6">
                  <label class="form-label">Address Line 1</label>
                  <input
                    type="text"
                    name="permanentAddressLine1"
                    class="form-control"
                  />
                </div>
                <div class="col-md-6">
                  <label class="form-label">Address Line 2</label>
                  <input
                    type="text"
                    name="permanentAddressLine2"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">City</label>
                  <input type="text" name="permanentCity" class="form-control" />
                </div>
                <div class="col-md-4">
                  <label class="form-label">State</label>
                  <input type="text" name="permanentState" class="form-control" />
                </div>
                <div class="col-md-2">
                  <label class="form-label">ZIP</label>
                  <input type="text" name="permanentZip" class="form-control" />
                </div>
                <div class="col-md-2">
                  <label class="form-label">Country</label>
                  <input type="text" name="permanentCountry" class="form-control" />
                </div>
              </div>
            </div>

            {{!-- TAB 2: PROFESSIONAL DETAILS --}}
            <div
              class="tab-pane fade"
              id="tab-job"
              role="tabpanel"
              aria-labelledby="job-tab"
            >
              <div class="row g-3">
                <div class="col-md-4">
                  <label class="form-label">Employee ID (optional)</label>
                  <input type="text" name="empId" class="form-control" />
                  <small class="text-muted">
                    Leave blank to autogenerate (EMP0001…)
                  </small>
                </div>

                <div class="col-md-4">
                  <label class="form-label">Employee Type</label>
                  <select name="employeeType" class="form-select" required>
                    <option value="Permanent">Permanent</option>
                    <option value="Contract">Contract</option>
                    <option value="Intern">Intern</option>
                    <option value="Consultant">Consultant</option>
                    <option value="Trainee">Trainee</option>
                  </select>
                </div>

                <div class="col-md-4">
                  <label class="form-label">Employment Status</label>
                  <select name="employmentStatus" class="form-select">
                    <option value="Active">Active</option>
                    <option value="On Leave">On Leave</option>
                    <option value="Resigned">Resigned</option>
                    <option value="Terminated">Terminated</option>
                    <option value="Retired">Retired</option>
                  </select>
                </div>

                <div class="col-md-6">
                  <label class="form-label">Designation</label>
                  <input
                    type="text"
                    name="empDesignation"
                    class="form-control"
                    required
                  />
                </div>

                <div class="col-md-6">
                  <label class="form-label">Department</label>
                  <input
                    type="text"
                    name="empDepartment"
                    class="form-control"
                    required
                  />
                </div>

                <div class="col-md-6">
                  <label class="form-label">Division / Business Unit</label>
                  <input
                    type="text"
                    name="division"
                    class="form-control"
                  />
                </div>

                <div class="col-md-6">
                  <label class="form-label">Sub-Department / Team</label>
                  <input
                    type="text"
                    name="subDepartment"
                    class="form-control"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Grade / Band / Level</label>
                  <input
                    type="text"
                    name="gradeBandLevel"
                    class="form-control"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Reporting Manager (Employee ID / Ref)</label>
                  <input
                    type="text"
                    name="reportingManagerId"
                    class="form-control"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Work Mode</label>
                  <select name="workMode" class="form-select">
                    <option value="On-site">On-site</option>
                    <option value="Hybrid">Hybrid</option>
                    <option value="Remote">Remote</option>
                  </select>
                </div>

                <div class="col-md-4">
                  <label class="form-label">Work Location</label>
                  <input
                    type="text"
                    name="empWorkLoc"
                    class="form-control"
                    required
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Date of Joining</label>
                  <input
                    type="date"
                    name="empDateOfJoining"
                    class="form-control"
                    required
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Probation Period (months)</label>
                  <input
                    type="number"
                    name="probationPeriodMonths"
                    class="form-control"
                    min="0"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Confirmation Date</label>
                  <input
                    type="date"
                    name="confirmationDate"
                    class="form-control"
                  />
                </div>
              </div>
            </div>

            {{!-- TAB 3: COMPENSATION & KYC --}}
            <div
              class="tab-pane fade"
              id="tab-comp"
              role="tabpanel"
              aria-labelledby="comp-tab"
            >
              <div class="row g-3">
                <div class="col-md-4">
                  <label class="form-label">CTC (₹ - Annual)</label>
                  <input
                    type="number"
                    step="0.01"
                    name="empCtc"
                    class="form-control"
                    required
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Gross Salary (Monthly)</label>
                  <input
                    type="number"
                    step="0.01"
                    name="grossSalaryMonthly"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Basic Salary</label>
                  <input
                    type="number"
                    step="0.01"
                    name="basicSalary"
                    class="form-control"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">HRA</label>
                  <input
                    type="number"
                    step="0.01"
                    name="hra"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Conveyance Allowance</label>
                  <input
                    type="number"
                    step="0.01"
                    name="conveyanceAllowance"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Medical Allowance</label>
                  <input
                    type="number"
                    step="0.01"
                    name="medicalAllowance"
                    class="form-control"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Special Allowance / Other</label>
                  <input
                    type="number"
                    step="0.01"
                    name="specialAllowance"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Performance Bonus</label>
                  <input
                    type="number"
                    step="0.01"
                    name="performanceBonus"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Variable Pay</label>
                  <input
                    type="number"
                    step="0.01"
                    name="variablePay"
                    class="form-control"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Overtime Eligibility</label>
                  <select name="overtimeEligible" class="form-select">
                    <option value="false">No</option>
                    <option value="true">Yes</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Shift Allowance</label>
                  <input
                    type="number"
                    step="0.01"
                    name="shiftAllowance"
                    class="form-control"
                  />
                </div>

                <div class="col-12">
                  <hr />
                  <h6>Deductions</h6>
                </div>

                <div class="col-md-3">
                  <label class="form-label">PF</label>
                  <input
                    type="number"
                    step="0.01"
                    name="pfDeduction"
                    class="form-control"
                  />
                </div>
                <div class="col-md-3">
                  <label class="form-label">ESI</label>
                  <input
                    type="number"
                    step="0.01"
                    name="esiDeduction"
                    class="form-control"
                  />
                </div>
                <div class="col-md-3">
                  <label class="form-label">Professional Tax</label>
                  <input
                    type="number"
                    step="0.01"
                    name="professionalTax"
                    class="form-control"
                  />
                </div>
                <div class="col-md-3">
                  <label class="form-label">TDS</label>
                  <input
                    type="number"
                    step="0.01"
                    name="tdsDeduction"
                    class="form-control"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Net Salary (In-hand)</label>
                  <input
                    type="number"
                    step="0.01"
                    name="netSalary"
                    class="form-control"
                  />
                </div>

                <div class="col-12">
                  <hr />
                  <h6>KYC</h6>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Aadhaar</label>
                  <input
                    type="text"
                    name="empAadhar"
                    maxlength="12"
                    class="form-control"
                    required
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">PAN</label>
                  <input
                    type="text"
                    name="empPan"
                    maxlength="10"
                    class="form-control"
                    required
                  />
                </div>
              </div>
            </div>

            {{!-- TAB 4: ATTENDANCE & LEAVE --}}
            <div
              class="tab-pane fade"
              id="tab-attendance"
              role="tabpanel"
              aria-labelledby="att-tab"
            >
              <div class="row g-3">
                <div class="col-md-4">
                  <label class="form-label">Shift Name</label>
                  <input type="text" name="shiftName" class="form-control" />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Shift Code</label>
                  <input type="text" name="shiftCode" class="form-control" />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Shift Type</label>
                  <select name="shiftType" class="form-select">
                    <option value="">Select</option>
                    <option value="Fixed">Fixed</option>
                    <option value="Rotational">Rotational</option>
                    <option value="Split">Split</option>
                    <option value="Flexible">Flexible</option>
                  </select>
                </div>

                <div class="col-md-3">
                  <label class="form-label">Start Time</label>
                  <input type="time" name="shiftStartTime" class="form-control" />
                </div>
                <div class="col-md-3">
                  <label class="form-label">End Time</label>
                  <input type="time" name="shiftEndTime" class="form-control" />
                </div>
                <div class="col-md-3">
                  <label class="form-label">Total Work Hours</label>
                  <input
                    type="number"
                    step="0.01"
                    name="totalWorkHours"
                    class="form-control"
                  />
                </div>
                <div class="col-md-3">
                  <label class="form-label">Break Duration (mins)</label>
                  <input
                    type="number"
                    name="breakDurationMinutes"
                    class="form-control"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Shift Rotation Cycle</label>
                  <input
                    type="text"
                    name="shiftRotationCycle"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Grace Period (mins)</label>
                  <input
                    type="number"
                    name="gracePeriodMinutes"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Half-Day Rule (hours)</label>
                  <input
                    type="number"
                    step="0.01"
                    name="halfDayRuleHours"
                    class="form-control"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Shift Effective From</label>
                  <input
                    type="date"
                    name="shiftEffectiveFrom"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Timezone</label>
                  <input
                    type="text"
                    name="workTimezone"
                    class="form-control"
                    placeholder="e.g. Asia/Kolkata"
                  />
                </div>
              </div>
            </div>

            {{!-- TAB 5: COMPLIANCE & ACCESS --}}
            <div
              class="tab-pane fade"
              id="tab-compliance"
              role="tabpanel"
              aria-labelledby="compAccess-tab"
            >
              <div class="row g-3">
                <div class="col-12">
                  <h6>ID Proof (Primary)</h6>
                </div>
                <div class="col-md-4">
                  <label class="form-label">ID Proof Type</label>
                  <select name="idProofType" class="form-select">
                    <option value="">Select</option>
                    <option value="Aadhaar">Aadhaar</option>
                    <option value="PAN">PAN</option>
                    <option value="Passport">Passport</option>
                    <option value="Driving License">Driving License</option>
                    <option value="Voter ID">Voter ID</option>
                    <option value="National ID">National ID</option>
                    <option value="Other">Other</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label">ID Proof Number</label>
                  <input
                    type="text"
                    name="idProofNumber"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Country of Issue</label>
                  <input
                    type="text"
                    name="idCountryOfIssue"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">ID Expiry Date</label>
                  <input
                    type="date"
                    name="idExpiryDate"
                    class="form-control"
                  />
                </div>

                <div class="col-12 mt-3">
                  <hr />
                  <h6>System Access</h6>
                </div>
                <div class="col-md-4">
                  <label class="form-label">Work Email</label>
                  <input
                    type="email"
                    name="workEmail"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">Username / Login ID</label>
                  <input
                    type="text"
                    name="username"
                    class="form-control"
                  />
                </div>
                <div class="col-md-4">
                  <label class="form-label">System Role / Access Level</label>
                  <input
                    type="text"
                    name="systemRole"
                    class="form-control"
                    placeholder="e.g. Employee, Manager, HR"
                  />
                </div>

                <div class="col-md-4">
                  <label class="form-label">Account Status</label>
                  <select name="accountStatus" class="form-select">
                    <option value="Active">Active</option>
                    <option value="Locked">Locked</option>
                    <option value="Suspended">Suspended</option>
                    <option value="Disabled">Disabled</option>
                  </select>
                </div>

                <div class="col-md-4 d-flex align-items-center">
                  <div class="form-check mt-3">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="mfaEnabled"
                      name="mfaEnabled"
                    />
                    <label class="form-check-label" for="mfaEnabled">
                      Enable MFA / 2FA
                    </label>
                  </div>
                </div>
              </div>
            </div>

          </div> {{!-- end tab-content --}}
        </div> {{!-- end modal-body --}}

        <div class="modal-footer">
          <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">
            Cancel
          </button>

          {{!-- Wizard buttons --}}
          <button
            class="btn btn-primary"
            type="button"
            id="wizardNextBtn"
          >
            Next
          </button>
          <button
            class="btn btn-primary d-none"
            type="submit"
            id="wizardSaveBtn"
          >
            Save Employee
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  (function () {
    const steps = ['tab-basic', 'tab-job', 'tab-comp', 'tab-attendance', 'tab-compliance'];
    let currentStep = 0;

    const nextBtn = document.getElementById('wizardNextBtn');
    const saveBtn = document.getElementById('wizardSaveBtn');
    const tabsContainer = document.getElementById('addEmployeeTabs');
    const modalEl = document.getElementById('addEmployeeModal');

    function updateWizardButtons() {
      if (currentStep === steps.length - 1) {
        // Last step: hide Next, show Save
        nextBtn.classList.add('d-none');
        saveBtn.classList.remove('d-none');
      } else {
        // Not last step: show Next, hide Save
        nextBtn.classList.remove('d-none');
        saveBtn.classList.add('d-none');
      }
    }

    function goToStep(index) {
      if (index < 0 || index >= steps.length) return;
      const targetId = steps[index];
      const trigger = document.querySelector('[data-bs-target="#' + targetId + '"]');
      if (trigger && window.bootstrap) {
        const tab = new bootstrap.Tab(trigger);
        tab.show();
      }
    }

    // Handle Next button click
    nextBtn.addEventListener('click', function () {
      if (currentStep < steps.length - 1) {
        currentStep += 1;
        goToStep(currentStep);
        updateWizardButtons();
      }
    });

    // When tab changes (user clicks tab directly), sync currentStep + buttons
    if (tabsContainer) {
      tabsContainer.addEventListener('shown.bs.tab', function (event) {
        const target = event.target.getAttribute('data-bs-target'); // e.g. "#tab-job"
        if (!target) return;
        const id = target.replace('#', '');
        const idx = steps.indexOf(id);
        if (idx !== -1) {
          currentStep = idx;
          updateWizardButtons();
        }
      });
    }

    // When modal opens, always reset to first step
    if (modalEl) {
      modalEl.addEventListener('shown.bs.modal', function () {
        currentStep = 0;
        goToStep(currentStep);
        updateWizardButtons();
      });
    }

    // Simple copy for "same as present" (front-end only helper)
    const sameAsPresentCheckbox = document.getElementById('sameAsPresent');
    if (sameAsPresentCheckbox) {
      sameAsPresentCheckbox.addEventListener('change', function () {
        if (!this.checked) return;
        const copyField = (from, to) => {
          const f = document.querySelector('[name="' + from + '"]');
          const t = document.querySelector('[name="' + to + '"]');
          if (f && t) t.value = f.value;
        };
        copyField('presentAddressLine1', 'permanentAddressLine1');
        copyField('presentAddressLine2', 'permanentAddressLine2');
        copyField('presentCity', 'permanentCity');
        copyField('presentState', 'permanentState');
        copyField('presentZip', 'permanentZip');
        copyField('presentCountry', 'permanentCountry');
      });
    }

    // Form submit logic (only from final step)
    document.getElementById('addEmployeeForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const form = e.target;
      const data = Object.fromEntries(new FormData(form).entries());

      try {
        const res = await fetch('/api/v1/employees', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });

        if (!res.ok) {
          const err = await res.json().catch(() => ({}));
          throw new Error(err.error || 'Failed to create employee');
        }

        window.location.reload();
      } catch (err) {
        alert(err.message);
      }
    });
  })();
</script>


<script>
  (function () {
    const steps = ['tab-basic', 'tab-job', 'tab-comp'];
    let currentStep = 0;

    const nextBtn = document.getElementById('wizardNextBtn');
    const saveBtn = document.getElementById('wizardSaveBtn');
    const tabsContainer = document.getElementById('addEmployeeTabs');
    const modalEl = document.getElementById('addEmployeeModal');

    function updateWizardButtons() {
      if (currentStep === steps.length - 1) {
        // Last step: hide Next, show Save
        nextBtn.classList.add('d-none');
        saveBtn.classList.remove('d-none');
      } else {
        // Not last step: show Next, hide Save
        nextBtn.classList.remove('d-none');
        saveBtn.classList.add('d-none');
      }
    }

    function goToStep(index) {
      if (index < 0 || index >= steps.length) return;
      const targetId = steps[index];
      const trigger = document.querySelector('[data-bs-target="#' + targetId + '"]');
      if (trigger && window.bootstrap) {
        const tab = new bootstrap.Tab(trigger);
        tab.show();
      }
    }

    // Handle Next button click
    nextBtn.addEventListener('click', function () {
      if (currentStep < steps.length - 1) {
        currentStep += 1;
        goToStep(currentStep);
        updateWizardButtons();
      }
    });

    // When tab changes (user clicks tab directly), sync currentStep + buttons
    if (tabsContainer) {
      tabsContainer.addEventListener('shown.bs.tab', function (event) {
        const target = event.target.getAttribute('data-bs-target'); // e.g. "#tab-job"
        if (!target) return;
        const id = target.replace('#', '');
        const idx = steps.indexOf(id);
        if (idx !== -1) {
          currentStep = idx;
          updateWizardButtons();
        }
      });
    }

    // When modal opens, always reset to first step
    if (modalEl) {
      modalEl.addEventListener('shown.bs.modal', function () {
        currentStep = 0;
        goToStep(currentStep);
        updateWizardButtons();
      });
    }

    // Form submit logic (only from final step)
    document.getElementById('addEmployeeForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      const form = e.target;
      const data = Object.fromEntries(new FormData(form).entries());

      try {
        const res = await fetch('/api/v1/employees', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });

        if (!res.ok) {
          const err = await res.json().catch(() => ({}));
          throw new Error(err.error || 'Failed to create employee');
        }

        window.location.reload();
      } catch (err) {
        alert(err.message);
      }
    });
  })();
</script>
